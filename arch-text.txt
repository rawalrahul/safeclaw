SafeClaw
Secure Personal AI Assistant
Architecture Specification
Version 0.1.0

February 2026
Confidential

TOC \h \o "1-3"

1. Executive Summary
SafeClaw is a secure, privacy-first personal AI assistant designed as a more secure alternative to OpenClaw. It operates as its own bot identity on Telegram and WhatsApp, never impersonating the user. The system is dormant by default and only activates when the authenticated owner explicitly sends a wake command.
The core design philosophy is that every capability must be explicitly granted and every dangerous action must be explicitly approved. This document covers the full system architecture, security model, deployment topology, and future roadmap.
2. Problem Statement
OpenClaw, while feature-rich, has several security concerns that SafeClaw addresses:
It hijacks the user’s WhatsApp session via Baileys, acting as the user and exposing the account to risk.
It runs as an always-on daemon with a large attack surface, processing messages continuously.
Tool permissions are configured statically at setup time and cannot be toggled at runtime.
Dangerous actions like file writes and shell execution proceed without per-action confirmation.
Inbound DM pairing is reactive, sending responses to unknown senders that leak the bot’s existence.
SafeClaw solves each of these by inverting the defaults: everything is off until the owner explicitly turns it on.
3. Security Comparison
The following table compares the security posture of OpenClaw and SafeClaw across key dimensions:
Aspect
OpenClaw
SafeClaw
Identity
Hijacks user WhatsApp via Baileys
Own bot number (Telegram Bot / WhatsApp Cloud API)
Default State
Always-on daemon
Dormant until /wake from owner
Tool Access
Static config profiles
Runtime enable/disable per tool
Dangerous Actions
Executes immediately
Requires /confirm before execution
Auth Model
DM pairing (reactive)
Single owner by Telegram ID (proactive)
Strangers
Receives pairing code response
Silent drop (zero info leak)

4. System Architecture
4.1 Gateway State Machine
The gateway operates as a finite state machine with four states. It starts in DORMANT and only transitions when the authenticated owner sends commands. The state machine ensures that the system is never processing messages or executing tools without explicit activation.
From
Trigger
To
Effect
DORMANT
/wake from owner
AWAKE
All tools disabled, timer starts
AWAKE
Dangerous action requested
ACTION_PENDING
Approval request sent to owner
ACTION_PENDING
/confirm or /deny
AWAKE
Action executed or rejected
AWAKE
/sleep or timeout
DORMANT
Tools disabled, session cleared
AWAKE
/kill
SHUTDOWN
Process exits cleanly
The inactivity timeout (default: 30 minutes) automatically returns the gateway to DORMANT if the owner stops interacting. This prevents the bot from remaining active indefinitely if the owner forgets to send /sleep.
4.2 Single-Owner Authentication
SafeClaw uses a zero-trust authentication model. The owner’s Telegram user ID is stored during initial setup. Every inbound message is checked against this ID before any processing occurs. Messages from non-owners are silently dropped with no response, no error message, and no information leak. This is intentional: even acknowledging that a bot exists at a given address is an information leak.
For WhatsApp (future), the owner’s phone number serves as the identity. The WhatsApp Cloud API provides verified sender phone numbers, making spoofing infeasible.
4.3 Tool Registry
The tool registry manages six tool categories, each independently togglable at runtime:
Tool
Description
Default
Confirm Required
browser
Web browsing and search
DISABLED
Yes
filesystem
Read, write, and delete files
DISABLED
Write/Delete only
shell
Execute shell commands
DISABLED
Yes
code_exec
Run code snippets in sandbox
DISABLED
Yes
network
HTTP requests and API calls
DISABLED
Yes
messaging
Send messages to contacts
DISABLED
Yes
On every /wake, all tools reset to DISABLED. This ensures a clean permission state for each session. The owner must consciously enable each tool they need. Disabled tools are not included in the AI agent’s system prompt, making them invisible to the model and eliminating the possibility of the agent requesting a disabled tool.
4.4 Permission Confirmation Flow
Even when a tool is enabled, dangerous actions require a two-step approval flow:
The AI agent requests an action (e.g., write a file, execute a shell command).
The gateway intercepts the request and generates an approval with a unique 8-character ID.
The owner receives a message describing the action, the tool, the target, and the expiry time.
The owner replies /confirm <id> to approve or /deny <id> to reject.
If no response within 5 minutes, the action is automatically denied.
The decision is logged to the audit trail regardless of outcome.
Safe actions (like reading a file or browsing a search result) execute immediately without confirmation, keeping the experience fluid for low-risk operations.

4.5 Audit Logging
Every significant event is written to a JSONL audit log stored at ~/.safeclaw/audit.jsonl. Events include authentication attempts (both successful and rejected), gateway state transitions, tool enable/disable actions, permission requests and their outcomes, action executions and failures, and auto-sleep triggers. The owner can query the log via the /audit command in chat, providing real-time visibility into what the system has done.
5. Channel Integration
5.1 Telegram (Implemented)
The prototype uses the grammy library to connect to the Telegram Bot API. The bot runs as a standard Telegram bot with its own username and identity. Long polling is used for receiving updates, avoiding the need for webhook infrastructure. Messages are sent as plain text with basic formatting.
5.2 WhatsApp Cloud API (Future)
For WhatsApp integration, SafeClaw will use the official WhatsApp Cloud API (not Baileys). This requires a WhatsApp Business account and a dedicated phone number. The Cloud API provides webhook-based message delivery with verified sender phone numbers, making it significantly more secure than session-hijacking approaches.
Key implementation considerations for WhatsApp Cloud API:
Webhook endpoint with signature verification for inbound messages.
Message template pre-approval for outbound notifications (WhatsApp policy requirement).
Phone number verification during onboarding to bind the owner identity.
Rate limiting compliance with WhatsApp’s messaging tiers.
6. Command Interface
The following commands are available to the authenticated owner via Telegram or WhatsApp:
Command
Description
Requires Awake
/wake
Activate the gateway from dormant state
No (this IS the wake)
/sleep
Return gateway to dormant mode
Yes
/kill
Emergency shutdown of the process
Yes
/tools
List all tools and their enable/disable status
Yes
/enable <tool>
Enable a specific tool for the current session
Yes
/disable <tool>
Disable a specific tool immediately
Yes
/confirm <id>
Approve a pending dangerous action
Yes
/deny <id>
Reject a pending dangerous action
Yes
/status
Show gateway state, uptime, enabled tools
Yes
/audit [n]
Show last N audit log events
Yes

7. Threat Model
The following table summarizes the key threats, mitigations, and residual risks:
Threat
Mitigation
Residual Risk
Unauthorized access
Single-owner auth by Telegram ID; silent drop for all others
Low: Telegram ID spoofing is not feasible via Bot API
Prompt injection
Tools off by default; dangerous actions require /confirm; audit log
Medium: AI agent could be manipulated but actions still gated
Session hijacking
Bot is separate identity, not user account; no session to hijack
Low: Bot token compromise requires server access
Unintended actions
Permission confirmation for all dangerous actions; 5-min expiry
Low: Owner must explicitly /confirm each action
Data exfiltration
Network tool disabled by default; all actions audited
Medium: If network enabled, agent could leak data
Bot token leak
Token in .env file with restricted permissions; not in config
Medium: Requires file access hardening on host
7.1 Prompt Injection Defense
Prompt injection remains the most significant residual risk for any AI assistant. SafeClaw’s layered defense reduces the impact: tools are off by default (limiting what an injected prompt can do), dangerous actions require explicit /confirm (the owner sees what the agent wants to do before it happens), and the audit log provides post-hoc visibility into any suspicious behavior.
Future enhancements could include content scanning of agent responses before tool invocation, rate limiting on tool requests per session, and anomaly detection on tool usage patterns.
8. Production Deployment
8.1 Docker
For production deployment, SafeClaw should run in a Docker container with minimal privileges:
Run as non-root user with --cap-drop=ALL.
Use --read-only filesystem with a mounted volume for ~/.safeclaw storage.
Bind to loopback only if running a health-check HTTP endpoint.
Use Docker secrets for the Telegram bot token rather than environment variables.
8.2 Secrets Management
The Telegram bot token and owner ID should be stored securely. In development, .env files with restricted permissions (chmod 600) are acceptable. In production, use Docker secrets, HashiCorp Vault, or cloud provider secret managers. Never commit tokens to version control. The .env.example file contains placeholder values only.
8.3 Monitoring
The audit log provides the primary monitoring surface. For production, consider forwarding audit events to an external logging service (e.g., Datadog, Grafana Loki) for alerting on suspicious patterns such as repeated auth rejections from unknown senders, unexpected tool enable patterns, or high-frequency permission requests.
9. Future Roadmap
WhatsApp Cloud API integration with webhook endpoint and message templates.
Real AI agent integration (Claude API / OpenAI API) replacing simulated tool responses.
MCP (Model Context Protocol) server support for extensible tool connections.
Multi-owner support with invite codes and per-owner permission scopes.
Web dashboard for visual tool management and audit log browsing.
End-to-end encryption for stored audit logs and session data.
Rate limiting per tool and per session to prevent abuse.
Scheduled wake/sleep windows for automated workflows.
Plugin system for community-contributed tool integrations.

10. Project Structure
The SafeClaw prototype is organized as follows:
src/core/ — Gateway state machine, authentication, configuration, and shared types.
src/channels/telegram/ — Telegram bot client, message handler, and outbound sender.
src/tools/ — Tool registry with enable/disable logic and simulated tool stubs.
src/permissions/ — Approval store managing pending permission requests with expiry.
src/audit/ — JSONL event logger with query capabilities.
src/commands/ — Command parser and handler dispatch.
src/storage/ — File-based persistence layer for JSON and JSONL data.
10.1 Technology Stack
Runtime: Node.js 22+ with TypeScript (strict mode).
Telegram: grammy library for Bot API integration.
Storage: File-based JSON and JSONL (no database dependency).
Dependencies: Minimal footprint — grammy, dotenv, uuid only.
11. Getting Started
Create a Telegram bot via @BotFather and copy the bot token.
Find your Telegram user ID by messaging @userinfobot.
Copy .env.example to .env and fill in TELEGRAM_BOT_TOKEN and OWNER_TELEGRAM_ID.
Run npm install to install dependencies.
Run npx tsx src/index.ts to start the gateway.
Open Telegram, find your bot, and send /wake to activate.
Use /tools to see available tools, /enable <tool> to activate them.
Send natural language requests (e.g., “search latest news”) to invoke tools.
Approve dangerous actions with /confirm <id> when prompted.
Send /sleep when done, or let auto-sleep handle it after 30 minutes.